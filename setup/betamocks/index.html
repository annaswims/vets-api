
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Vets API deployment, setup, and history.">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.1.11">
    
    
      
        <title>Betamocks - Vets API</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50e68009.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#betamocks" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Vets API" class="md-header__button md-logo" aria-label="Vets API" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Vets API
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Betamocks
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/department-of-veterans-affairs/vets-api" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Vets API" class="md-nav__button md-logo" aria-label="Vets API" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Vets API
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/department-of-veterans-affairs/vets-api" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Deployment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Deployment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/information/" class="md-nav__link">
        Information
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Setup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Setup" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Setup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Betamocks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Betamocks
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mocking-a-service" class="md-nav__link">
    Mocking a Service
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mocking-error-responses" class="md-nav__link">
    Mocking error responses
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caching-mulitple-responses" class="md-nav__link">
    Caching mulitple responses
  </a>
  
    <nav class="md-nav" aria-label="Caching mulitple responses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-query-string-identifiers" class="md-nav__link">
    For query string identifiers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-header-identifiers" class="md-nav__link">
    For header identifiers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-url-identifiers" class="md-nav__link">
    For URL identifiers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-request-body-identifiers" class="md-nav__link">
    For request body identifiers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debugging_with_docker_rubymine_windows/" class="md-nav__link">
        Debugging with Docker RubyMine Windows
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3">
          Developer Setup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developer Setup" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Developer Setup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hybrid/" class="md-nav__link">
        Hybrid Developer Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../native/" class="md-nav__link">
        Native Developer Setup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../edu_benefits/" class="md-nav__link">
        Education Benefits Year to Date Report
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../evss/" class="md-nav__link">
        EVSS S3 Uploads
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../facilities_locator/" class="md-nav__link">
        Facilities Locator Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../local_network_access/" class="md-nav__link">
        Local Network Access
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mailer/" class="md-nav__link">
        Mailers Info
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mhv/" class="md-nav__link">
        MHV Prescriptions and MHV Secure Messaging Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mpi/" class="md-nav__link">
        MPI Service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rswag_setup/" class="md-nav__link">
        Rswag setup for Rails engine
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_13" type="checkbox" id="__nav_2_13" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_13">
          Running the App
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Running the App" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_13">
          <span class="md-nav__icon md-icon"></span>
          Running the App
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../running_docker/" class="md-nav__link">
        Running the app with Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../running_natively/" class="md-nav__link">
        Running the app Natively
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../virtual_machine_access/" class="md-nav__link">
        Virtual Machine Access
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../HISTORY/" class="md-nav__link">
        History
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mocking-a-service" class="md-nav__link">
    Mocking a Service
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mocking-error-responses" class="md-nav__link">
    Mocking error responses
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caching-mulitple-responses" class="md-nav__link">
    Caching mulitple responses
  </a>
  
    <nav class="md-nav" aria-label="Caching mulitple responses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-query-string-identifiers" class="md-nav__link">
    For query string identifiers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-header-identifiers" class="md-nav__link">
    For header identifiers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-url-identifiers" class="md-nav__link">
    For URL identifiers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-request-body-identifiers" class="md-nav__link">
    For request body identifiers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/department-of-veterans-affairs/vets-api/edit/main/docs/setup/betamocks.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="betamocks">Betamocks<a class="headerlink" href="#betamocks" title="Permanent link">&para;</a></h1>
<p>Betamocks is a Faraday middleware gem that mocks APIs by recording and replaying requests. It's especially useful for local development to mock out APIs that are behind a VPN, often go down, or when an API may not have a corresponding dev or staging environment. Mockdata for vets-api is in <a href="https://github.com/department-of-veterans-affairs/vets-api-mockdata">https://github.com/department-of-veterans-affairs/vets-api-mockdata</a></p>
<p>See also: <a href="https://github.com/department-of-veterans-affairs/vets-api-mockdata#create-mock-data-for-a-brand-new-service">https://github.com/department-of-veterans-affairs/vets-api-mockdata#create-mock-data-for-a-brand-new-service</a></p>
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><code>cd</code> to parent directory of <code>vets-api</code> and clone <code>vets-api-mockdata</code>,
e.g. if you checked out <code>vets-api</code> to <code>~/Documents</code> then:
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nb">cd</span> ~/Documents
git clone git@github.com:department-of-veterans-affairs/vets-api-mockdata.git
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>If you're using Docker there is no step 2 run <code>make up</code> to start vets-api. If you're 
not on Docker set the cache dir to the relative path of the mock data repo in 
config/development.yml file, you may need to run <code>bin/spring stop</code> for the change to take effect.
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">betamocks</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">  </span><span class="nt">recording</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<span class="w">  </span><span class="c1"># the cache dir depends on how you run the api, run `bin/spring stop` after switching this setting</span><span class="w"></span>
<span class="w">  </span><span class="nt">cache_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../vets-api-mockdata</span><span class="w"> </span><span class="c1"># via rails; e.g. bundle exec rails s or bundle exec rails c</span><span class="w"></span>
<span class="w">  </span><span class="c1">#cache_dir: /cache # via docker; e.g. make up or make console</span><span class="w"></span>
<span class="w">  </span><span class="nt">services_config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config/betamocks/services_config.yml</span><span class="w"></span>
</code></pre></div></td></tr></table></div></p>
</li>
</ol>
<p>Lighthouse devs can begin making api requests. Va.gov devs can now login with one of the <a href="https://github.com/department-of-veterans-affairs/vets.gov-team/blob/master/Products/Identity/MVI%20Integration/reference_documents/mvi_users_s1a.csv">test users</a>
without being connect to the VA VPN. By default all users have been mocked for MVI but
only M. Webb (<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#118;&#101;&#116;&#115;&#46;&#103;&#111;&#118;&#46;&#117;&#115;&#101;&#114;&#43;&#50;&#50;&#56;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;">&#118;&#101;&#116;&#115;&#46;&#103;&#111;&#118;&#46;&#117;&#115;&#101;&#114;&#43;&#50;&#50;&#56;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;</a>) will work for the other services unless their mock data has been added.</p>
<h2 id="mocking-a-service">Mocking a Service<a class="headerlink" href="#mocking-a-service" title="Permanent link">&para;</a></h2>
<p>If a service class implements response middleware, it is important to consider the order in which the middleware is stacked. For further details, refer to the <a href="https://www.rubydoc.info/gems/faraday#Advanced_middleware_usage">Faraday API documentation</a>. </p>
<p>In the following example, Betamocks will only record the raw response from the backing service, and will not record any transformations applied by the <code>::FacilityParser</code> or <code>::FacilityValidator</code> middlewares.  </p>
<div class="language-ruby highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">connection</span>
  <span class="no">Faraday</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="ss">headers</span><span class="p">:</span> <span class="n">base_request_headers</span><span class="p">,</span> <span class="ss">request</span><span class="p">:</span> <span class="n">request_options</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">use</span> <span class="ss">:breakers</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">request</span> <span class="ss">:json</span>

    <span class="n">conn</span><span class="o">.</span><span class="n">response</span> <span class="ss">:raise_error</span><span class="p">,</span> <span class="ss">error_prefix</span><span class="p">:</span> <span class="n">service_name</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">response</span> <span class="ss">:facility_parser</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">response</span> <span class="ss">:facility_validator</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">response</span> <span class="ss">:betamocks</span> <span class="k">if</span> <span class="no">Settings</span><span class="o">.</span><span class="n">locators</span><span class="o">.</span><span class="n">mock_gis</span>

    <span class="n">conn</span><span class="o">.</span><span class="n">adapter</span> <span class="no">Faraday</span><span class="o">.</span><span class="n">default_adapter</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></td></tr></table></div>
<ol>
<li>
<p>Add endpoints to be mocked to the services config file.
Each service description has a <code>base_uri</code> (pulled from Settings)
<code>endpoints</code> is an array of hashes with:
- <code>method:</code> a symbol of the http verb <code>:get</code>, <code>:post</code>, <code>:put</code>...
- <code>path:</code> the path that combined with the base_uri makes a full URI
- <code>file_path:</code> where to save the file (relative to betamocks' cache dir)
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">:services</span><span class="p p-Indicator">:</span><span class="w"></span>

<span class="c1"># EVSS::PCIUAddress</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:base_uri</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;%= URI(Settings.evss.url).host %&gt;</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">:endpoints</span><span class="p p-Indicator">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:method</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:get</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">:path</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/wss-pciu-services-web/rest/pciuServices/v1/states&quot;</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">:file_path</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;evss/pciu_address&quot;</span><span class="w"></span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>In config/settings.yml set betamocks recording to true:
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">betamocks</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">  </span><span class="nt">recording</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>Make a request. If a cache file does not exist one will be recorded (turn on your VA VPNs),
all subsequent requests will use the cache (feel free to turn off your VA VPNs).</p>
</li>
</ol>
<h2 id="mocking-error-responses">Mocking error responses<a class="headerlink" href="#mocking-error-responses" title="Permanent link">&para;</a></h2>
<p>You can record an error response or edit one manually to return an error status, or you can turn errors on and off
by adding an error key to the config with an optional body. Restart rails after updating the service config:
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:method</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:get</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">:path</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/wss-pciu-services-web/rest/pciuServices/v1/states&quot;</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">:file_path</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;evss/pciu_address&quot;</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">:error</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">400</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:method</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:get</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">:path</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/wss-pciu-services-web/rest/pciuServices/v1/states&quot;</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">:file_path</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;evss/pciu_address&quot;</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">:error</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">420</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">:body</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;{&quot;key&quot;:</span><span class="nv"> </span><span class="s">&quot;letter.generator.error&quot;,</span><span class="nv"> </span><span class="s">&quot;message&quot;:</span><span class="nv"> </span><span class="s">&quot;the</span><span class="nv"> </span><span class="s">letter</span><span class="nv"> </span><span class="s">generator</span><span class="nv"> </span><span class="s">hamsters</span><span class="nv"> </span><span class="s">have</span><span class="nv"> </span><span class="s">fallen</span><span class="nv"> </span><span class="s">asleep&quot;}&#39;</span><span class="w"></span>
</code></pre></div></td></tr></table></div></p>
<h2 id="caching-mulitple-responses">Caching mulitple responses<a class="headerlink" href="#caching-mulitple-responses" title="Permanent link">&para;</a></h2>
<p>To record multiple responses for a URI you can add a wildcard in place of the identifier
and add a matching locator or in the case of endpoints that use header or body values for identifiers you can write
a locator that will be appended to the cache file name. <code>query</code> and <code>header</code> uid_location types
use named locators, <code>url</code> and <code>body</code> types use regular expression matchers to extract locators:</p>
<h4 id="for-query-string-identifiers">For query string identifiers<a class="headerlink" href="#for-query-string-identifiers" title="Permanent link">&para;</a></h4>
<p>The below will record <code>/users?uuid=abc123</code> and <code>/users?uuid=efg456</code> to the same directory:
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">:endpoints</span><span class="p p-Indicator">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:method</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:get</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">:path</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/users&quot;</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">:file_path</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;users/list&quot;</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">:cache_multiple_responses</span><span class="p p-Indicator">:</span><span class="w"></span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">:uid_location</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">query</span><span class="w"></span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">:uid_locator</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;uuid&#39;</span><span class="w"></span>
</code></pre></div></td></tr></table></div></p>
<h4 id="for-header-identifiers">For header identifiers<a class="headerlink" href="#for-header-identifiers" title="Permanent link">&para;</a></h4>
<p>The below will record all <code>/evss/address</code> responses with different identifiers in the
request headers to the same directory:
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">:endpoints</span><span class="p p-Indicator">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:method</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:get</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">:path</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/evss/address&quot;</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">:file_path</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;evss/address&quot;</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">:cache_multiple_responses</span><span class="p p-Indicator">:</span><span class="w"></span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">:uid_location</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">header</span><span class="w"></span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">:uid_locator</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;va_eauth_pnid&#39;</span><span class="w"></span>
</code></pre></div></td></tr></table></div></p>
<h4 id="for-url-identifiers">For URL identifiers<a class="headerlink" href="#for-url-identifiers" title="Permanent link">&para;</a></h4>
<p>The below will record <code>/users/42/forms</code> and <code>/users/101/forms</code> to the same directory:
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">:endpoints</span><span class="p p-Indicator">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:method</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:get</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">:path</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/users/*/forms&quot;</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">:file_path</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;users/form&quot;</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">:cache_multiple_responses</span><span class="p p-Indicator">:</span><span class="w"></span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">:uid_location</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">url</span><span class="w"></span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">:uid_locator</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;\/users\/(.+)\/forms&#39;</span><span class="w"> </span><span class="c1"># matches anything &#39;(.+)&#39; between /users and /forms</span><span class="w"></span>
</code></pre></div></td></tr></table></div></p>
<h4 id="for-request-body-identifiers">For request body identifiers<a class="headerlink" href="#for-request-body-identifiers" title="Permanent link">&para;</a></h4>
<p>The below will record all <code>/mvi/find_profile</code> responses with different identifiers in the
XML request bodies to the same directory:
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">:endpoints</span><span class="p p-Indicator">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:method</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:post</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">:path</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/mvi/find_profile&quot;</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">:file_path</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;mvi/profiles&quot;</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">:cache_multiple_responses</span><span class="p p-Indicator">:</span><span class="w"></span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">:uid_location</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">body</span><span class="w"></span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">:uid_locator</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;(?:root=&quot;2.16.840.1.113883.4.1&quot;</span><span class="nv"> </span><span class="s">)?extension=&quot;(\d{9})&quot;(?:</span><span class="nv"> </span><span class="s">root=&quot;2.16.840.1.113883.4.1&quot;)?&#39;</span><span class="w"> </span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">extension=</span><span class="w"></span>
</code></pre></div></td></tr></table></div></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../deployment/information/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Information" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Information
            </div>
          </div>
        </a>
      
      
        
        <a href="../debugging_with_docker_rubymine_windows/" class="md-footer__link md-footer__link--next" aria-label="Next: Debugging with Docker RubyMine Windows" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Debugging with Docker RubyMine Windows
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.092fa1f6.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a9542cf.min.js"></script>
      
    
  </body>
</html>